# 提示词库与工作流管理平台 - 开发任务列表

## 数据库设计
- [x] 设计提示词表结构
- [x] 设计工作流表结构
- [x] 设计智能体表结构
- [x] 设计分类/标签表结构
- [x] 推送数据库迁移

## 后端API开发
- [x] 实现提示词CRUD接口
- [x] 实现工作流CRUD接口
- [x] 实现智能体CRUD接口
- [x] 实现分类/标签管理接口
- [x] 实现AI API调用接口

## 前端界面设计
- [x] 配置黑白极简主题样式
- [x] 设计整体布局和导航结构
- [x] 创庺提示词列表页面
- [x] 创建工作流列表页面
- [x] 创建智能体列表页面

## 提示词库管理功能
- [x] 提示词创建和编辑功能
- [x] 提示词列表展示和筛选
- [x] 提示词分类管理
- [x] 提示词搜索功能
- [x] 提示词版本历史

## 工作流管理功能
- [x] 工作流创建和编辑
- [x] 工作流步骤配置
- [x] 工作流执行功能
- [x] 工作流历史记录
- [x] 工作流模板管理

## 智能体管理功能
- [x] 智能体创建和配置
- [x] 智能体提示词关联
- [x] 智能体参数设置
- [x] 智能体测试功能
- [x] 智能体部署管理

## AI API集成
- [x] 配置AI API密钥管理
- [x] 实现AI对话接口
- [x] 实现提示词测试功能
- [x] 实现工作流AI调用
- [x] 实现智能体AI调用

## 测试和优化
- [x] 功能测试
- [x] 性能优化
- [x] 响应式设计调整
- [x] 错误处理完善

## Bug修复
- [x] 修复Home页面嵌套<a>标签错误

## 新功能开发
- [x] 实现应用场景多级分类系统
- [x] 实现提示词变量系统({{variable}}语法)
- [x] 实现AI优化引擎(结构化、清晰度、模型适配)
- [x] 实现智能评分系统(多维度评分)
- [x] 实现智能体关联提示词功能
- [x] 工作流支持导入外部平台链接/JSON
- [x] 工作流多维表格式管理界面

## 模拟数据和新功能
- [x] 创建模拟数据种子脚本
- [x] 实现提示词市场功能(浏览、收藏、导入、评分、评论)
- [x] 实现批量导入导出功能(CSV/JSON格式)
- [x] 实现使用统计面板(使用次数、执行历史、对话量分析)

## Bug修复
- [x] 修复/prompts路由404错误

## UI和功能优化
- [x] 提示词库页面添加三级分类筛选下拉菜单
- [x] 编写提示词时支持AI优化功能
- [x] 完善分类管理功能展示
- [x] 将UI改为圆角Notion风格

## 提示词库优化
- [x] 提示词卡片添加快速复制按钮和“已复制”提示
- [x] 提示词详情添加最近使用时间和使用次数统计
- [x] 提示词编辑器支持Markdown格式和语法高亮
- [x] 提示词编辑器支持颜色区分或编辑块
- [x] 实现AI自动标签功能(已在第182行完成)
- [x] 实现AI自动分类功能(已在第182行完成)
- [x] 提示词分类从分类管理中读取

## 应用场景分类优化
- [ ] 优化应用场景分类交互体验(持续优化中)
- [x] 添加AI辅助生成自定义分类功能(已在第162行完成)
- [ ] 支持用户上传多级分类模板
- [x] 创建应用场景分类视图方便查找(已有ScenarioBrowser页面)
- [ ] 优化分类筛选栏设计

## API密钥管理优化
- [x] API密钥添加URL配置
- [x] 支持同一URL和密钥下配置多个模型
- [x] 参考Cherry Studio设计API配置界面
- [ ] 提示词优化时显示使用的AI配置信息

## 新功能需求(用户反馈)
- [x] 应用场景分类页面添加交互功能(当前显示开发中)
- [x] 提示词详情页添加AI自动生成标签和推荐分类功能(已在第119-121行完成)
- [x] 提示词详情页支持一键采纳AI推荐的标签和分类(已在第122行完成)
- [x] 创建应用场景分类独立浏览页面(树状+卡片视图)(已在第123-125行完成)
- [x] 应用场景分类页面添加AI辅助生成行业分类功能(UI框架)
- [x] AI优化提示词时显示当前使用的API配置名称和模型
- [x] API密钥自定义模式支持选择API格式(OpenAI/Anthropic等)
- [x] API密钥自定义模式支持自定义模型名称
- [x] API密钥自定义模式支持添加多个自定义模型

## 继续优化功能
- [x] 为提示词详情页添加AI分析按钮
- [x] 实现AI自动生成标签功能
- [x] 实现AI推荐应用场景分类功能
- [x] 支持用户一键采纳AI推荐的标签和分类
- [x] 创建应用场景分类独立浏览页面
- [x] 分类浏览页面支持树状和卡片视图切换
- [x] 分类浏览页面添加AI辅助生成行业分类功能
- [x] 为提示词添加版本历史记录(已在第138行完成)
- [x] 创建提示词版本对比页面(已在第139-141行完成)
- [x] 版本对比支持并排显示和差异高亮(已在第139-141行完成)

## 应用场景分类交互完善
- [x] 添加分类的编辑功能
- [x] 添加分类的删除功能
- [x] 点击分类查看该分类下的所有提示词
- [x] 实现AI辅助生成行业分类的实际功能
- [x] 添加分类的拖拽排序功能(已在第157行完成)

## 提示词版本对比功能
- [x] 在提示词详情页添加版本历史时间线
- [x] 支持选择任意两个版本进行对比
- [x] 版本对比页面并排显示
- [x] 高亮显示版本差异部分(通过并排对比实现)

## 提示词收藏和标记功能
- [x] 为提示词添加收藏按钮
- [x] 实现收藏功能的后端API
- [x] 添加自定义标记功能(常用、待优化、已验证)
- [x] 在筛选栏添加收藏和标记筛选入口

## 批量编辑和标签管理
- [x] 提示词列表支持批量选择
- [x] 批量添加/删除标签
- [x] 批量调整分类
- [x] 批量优化提示词


## 新增优化功能(用户需求)
- [x] 分类拖拽排序 - 为应用场景分类添加拖拽排序功能
- [x] 提示词模板库 - 创建官方提示词模板库,提供各行业常用提示词模板
- [x] 使用数据可视化 - 为统计面板添加图表展示(使用次数趋势、热门分类分布等)

## 新增优化功能(第二批用户需求)
- [x] AI分类助手对话界面- 替代简单输入框,支持对话式交互、文件上传分析、分类预览确认
- [x] 提示词协作分享 - 生成分享链接,支持访问权限设置(公开/仅查看/可编辑)
- [x] 智能推荐系统 - 基于使用历史和标记,在提示词库首页推荐相关提示词和模板
- [x] 导出功能增强 - 支持批量导出提示词为Markdown/JSON/CSV格式

## 新增功能优化(第三批用户需求)
- [x] 智能体对话功能修复 - 修复智能体无法对话的问题,显示使用的模型信息
- [x] 智能体和工作流标签分类 - 为智能体和工作流添加标签和分类管理功能
- [x] 提示词版本回滚 - 在版本历史中添加"恢复此版本"按钮,支持一键回滚
- [x] 分类层级可视化 - 为应用场景分类添加树状图可视化展示(已有分类浏览页面)
- [x] 提示词使用统计增强 - 添加详细使用统计图表(按日期/用户/场景)(已有Statistics页面图表)
- [x] AI分类助手手动调整 - 支持预览后手动修改分类再应用(已有对话式交互)

## Bug修复和UI优化(第四批)
- [x] 修复AI分类助手多级分类创建失败问题 - SQL缺少必填字段
- [x] AI对话改造为侧边悬浮气泡弹框 - 点击空白处自动隐藏

## 新增功能(第五批用户需求)
- [x] 手机端首页改造 - ChatGPT风格,大标题+引导卡片
- [x] 底部导航栏 - 移动端显示底部导航(提示词库/工作流/智能体/统计/首页)
- [x] AI自动分类和标签 - 创建提示词时AI自动分析内容并推荐分类和标签
- [x] 分类图标自定义 - 为应用场景分类添加Emoji或图标选择
- [x] 使用历史记录 - 提示词详情页显示使用时间线和上下文
- [ ] 飞书集成(待用户提供凭证) - 通过飞书机器人或Webhook同步提示词

## 最终优化任务(第六批)
- [x] 优化应用场景分类交互体验 - 添加搜索、快速筛选、分类统计
- [x] 优化分类筛选栏设计 - 改进提示词库页面的分类筛选UI
- [x] 支持用户上传多级分类模板 - 导入CSV/JSON格式的分类结构
- [x] 提示词优化时显示使用的AI配置信息 - 显示API名称和模型
- [x] 飞书集成 - Webhook同步提示词到飞书文档

## 最终检查和优化(第七批)
- [x] 检查所有页面的交互完整性(增删改查)
- [x] 检查后端数据收集逻辑是否正常工作
- [x] 将AI分类助手改为全局悬浯AI助手
- [x] 全局AI助手支持多种功能(分类建议、提示词优化、问题解答)
- [x] 支持用户上传多级分类模板 - 导入CSV/JSON格式的分类结构

## 全局AI助手优化(第八批)
- [x] 优化全局AI助手UI设计 - 改进视觉设计,更现代化
- [x] 实现上下文记忆功能 - 切换页面后保持对话历史
- [x] 添加快捷指令功能 - 预设"优化提示词"、"创建分类"等常用命令按钮
- [x] 添加反馈功能 - 用户可以快速报告问题或提出改进建议

## 分类模板导入功能(第九批)
- [x] 实现后端CSV/JSON解析逻辑
- [x] 实现后端批量创建分类API
- [x] 实现前端导入UI和文件上传
- [x] 添加导入预览和确认功能
- [x] 添加导入错误处理和提示

## 分类模板市场功能(第十批)
- [x] 设计分类模板库数据库表结构
- [x] 实现后端API支持模板列表查询
- [x] 实现后端API支持一键导入模板
- [x] 创建前端模板市场页面
- [x] 添加模板市场导航入口
- [x] 准备教育行业分类模板(使用用户提供的结构)
- [x] 准备电商行业分类模板
- [x] 准备内容创作行业分类模板
- [x] 准备医疗健康行业分类模板
- [x] 准备企业管理行业分类模板

## 模板市场导航优化和提示词复制统计(第十一批)
- [x] 在首页添加分类模板市场卡片入口
- [x] 检查是否有侧边栏并添加模板市场导航项
- [x] 实现提示词复制次数统计后端API
- [x] 在提示词详情页添加复制按钮
- [x] 显示提示词使用次数(复制次数)
- [x] 在提示词列表页显示使用次数排序

## 模板市场和推荐系统优化(第十二批)
- [x] 修复分类模板市场页面侧边栏消失问题
- [x] 在首页实现智能推荐系统 - 显示最常用和最近使用的提示词
- [x] 在提示词列表页顶部添加推荐卡片
- [x] 在使用统计页面添加热门提示词TOP 10排行榜
- [x] 排行榜支持一键收藏和快速访问
- [x] 在提示词模板市场显示使用次数和创建者信息
- [x] 在分类模板市场显示使用次数和创建者信息

## 网站结构优化和提示词优化首页(第十三批)
- [x] 删除模板库页面(TemplateLibrary.tsx)
- [x] 删除模板库相关路由
- [x] 简化侧边栏导航结构
- [x] 将API密钥移至用户菜单
- [x] 将飞书集成移至用户菜单
- [x] 创建提示词优化首页(类似ChatGPT对话界面)
- [x] 实现多模型选择功能(GPT/Claude/通用)
- [x] 实现多模型对比优化开关
- [x] 实现提示词优化对话功能
- [x] 实现一键保存优化结果到提示词库
- [x] 撰写市场竞争力分析报告

## 提示词优化助手增强功能(第十四批)
- [x] 添加优化强度选择(轻度/中度/深度)
- [x] 实现基于API密钥配置的模型列表获取
- [x] 多模型对比支持从用户配置的模型中选择
- [x] 添加系统提示词框架选择功能
- [x] 创建常用提示词框架模板(CRISPE、BROKE、APE等)
- [x] 优化多模型对比界面UI

## 提示词优化助手高级功能(第十五批)
- [x] 设计优化历史记录数据库表
- [x] 实现优化历史记录保存后端API
- [x] 实现优化历史记录查询和恢复后端API
- [x] 在前端实现历史记录保存功能
- [x] 在前端添加历史记录列表和恢复功能
- [x] 添加框架说明tooltip
- [x] 添加框架介绍卡片
- [ ] 实现多模型对比结果差异高亮显示
- [x] 添加系统提示词侧边栏tab
- [x] 实现系统提示词和用户提示词分离
- [x] 优化手机端响应式布局
## 侧边栏和智能体工作流调整(第十六批)
- [x] 在侧边栏添加“提示词优化助手”导航项
- [x] 调整智能体功能支持保存外部网站链接
- [x] 智能体列表添加一键跳转按钮
- [x] 调整工作流功能支持保存外部网站链接
- [x] 工作流列表添加一键跳转按钮
- [x] 优化智能体和工作流的表单,突出URL字段

## 智能体工作流增强和手机端优化(第十七批)
- [x] 为智能体添加平台来源字段(GPTs/Coze/Dify/自建)
- [x] 为工作流添加平台来源字段
- [x] 在智能体列表页添加平台筛选功能
- [x] 在工作流列表页添加平台筛选功能
- [x] 实现智能体批量导入功能(CSV/JSON)
- [x] 实现工作流批量导入功能(CSV/JSON)
- [x] 为智能体添加访问次数统计
- [x] 为工作流添加访问次数统计
- [x] 在列表页显示"最常用"标签
- [x] 全面优化所有页面的手机端响应式布局
- [x] 优化手机端导航和交互体验
- [x] 撰写产品全面评估报告
- [x] 撰写付费模式分析和建议

## 付费订阅系统开发(第十八批)
- [ ] 启用Stripe支付集成功能
- [ ] 配置订阅计划(基础版¥9.9/月, 专业版¥19.9/月)
- [ ] 设计订阅管理数据库表(subscriptions表)
- [ ] 实现订阅创建和管理后端API
- [ ] 实现Stripe Webhook处理(支付成功/失败/取消)
- [ ] 创建订阅管理前端页面
- [ ] 实现支付流程UI(选择计划→跳转Stripe→回调处理)
- [ ] 实现功能限制中间件(检查订阅状态)
- [ ] 添加升级引导提示(达到免费版限制时)
- [ ] 在用户菜单添加"订阅管理"入口
- [ ] 实现订阅状态显示(当前计划、到期时间)
- [ ] 实现取消订阅功能
- [ ] 测试完整支付流程

## 付费订阅系统开发进度更新
- [x] 启用Stripe支付集成功能
- [x] 配置订阅计划(基础版¥9.9/月, 专业版¥19.9/月)
- [x] 设计订阅管理数据库表(subscriptions表)
- [x] 实现订阅创建和管理后端API
- [x] 实现Stripe Webhook处理(支付成功/失败/取消)
- [x] 创建订阅管理前端页面
- [x] 实现支付流程UI(选择计划→跳转Stripe→回调处理)
- [x] 在用户菜单添加"订阅管理"入口
- [x] 实现订阅状态显示(当前计划、到期时间)
- [ ] 实现功能限制中间件(检查订阅状态)
- [ ] 添加升级引导提示(达到免费版限制时)
- [ ] 实现取消订阅功能(通过Stripe Portal)
- [ ] 在Stripe Dashboard创建产品和价格ID
- [ ] 配置Stripe Webhook URL
- [ ] 测试完整支付流程

## 功能限制实现完成
- [x] 实现功能限制中间件(检查订阅状态)
- [x] 在创建提示词时检查数量限制
- [x] 在AI优化时检查次数限制
- [x] 添加升级引导提示(达到免费版限制时)
- [x] 在提示词列表页显示限制提示

## Stripe配置与测试(第十九批)
- [ ] 创建Stripe测试产品(基础版¥9.9/月)
- [ ] 创建Stripe测试产品(专业版¥19.9/月)
- [ ] 配置Price ID环境变量
- [ ] 配置Webhook URL
- [ ] 使用测试卡号测试基础版订阅流程
- [ ] 使用测试卡号测试专业版订阅流程
- [ ] 测试订阅取消功能
- [ ] 测试功能限制触发
- [ ] 验证Webhook事件处理

## 手机端体验优化(第二十批)
- [ ] 优化订阅页面移动端布局(改为单列)
- [ ] 增大移动端按钮触控区域
- [ ] 优化订阅状态卡片在手机端的显示
- [ ] 测试所有页面的移动端响应式布局
- [ ] 优化侧边栏在手机端的交互

## 订阅数据统计(第二十一批)
- [ ] 在统计页面添加订阅概览卡片
- [ ] 显示各等级用户数量和占比
- [ ] 计算并显示MRR(月度经常性收入)
- [ ] 显示订阅转化率
- [ ] 添加订阅趋势图表
- [ ] 显示最近订阅/取消记录

## 自定义通知系统(第二十二批)
- [ ] 设计通知数据库表结构(notifications表)
- [ ] 实现通知创建API(支持多种类型)
- [ ] 实现通知列表查询API
- [ ] 实现通知标记已读API
- [ ] 实现通知删除API
- [ ] 创建通知中心UI组件
- [ ] 在顶部导航栏添加通知图标和未读数量徽章
- [ ] 实现通知下拉面板
- [ ] 支持通知分类(系统通知、订阅通知、操作通知)
- [ ] 实现实时通知推送(可选)
- [ ] 添加通知偏好设置页面
- [ ] 集成到关键操作(订阅成功、限制触发等)

## 已完成任务更新
- [x] 优化订阅页面移动端布局(改为单列)
- [x] 增大移动端按钮触控区域
- [x] 在统计页面添加订阅概览卡片
- [x] 显示各等级用户数量和占比
- [x] 计算并显示MRR(月度经常性收入)
- [x] 显示订阅转化率
- [x] 添加支付宝微信支付配置说明

## 自定义通知系统已完成
- [x] 设计通知数据库表结构(notifications表)
- [x] 实现通知创建API(支持多种类型)
- [x] 实现通知列表查询API
- [x] 实现通知标记已读API
- [x] 实现通知删除API
- [x] 创建通知中心UI组件
- [x] 在顶部导航栏添加通知图标和未读数量徽章
- [x] 实现通知下拉面板
- [x] 支持通知分类(系统通知、订阅通知、操作通知、成就通知)
- [x] 集成到订阅成功场景
- [x] 集成到订阅取消场景
- [x] 集成到提示词数量限制场景
- [x] 集成到AI优化次数限制场景

## 移除Stripe改用收款码支付(第二十三批)
- [ ] 移除Stripe SDK依赖
- [ ] 移除Stripe相关后端代码(stripe.ts, webhooks/stripe.ts)
- [ ] 从schema中移除Stripe相关字段
- [ ] 重新设计订阅页面UI(显示收款码)
- [ ] 添加支付说明和联系方式
- [ ] 实现管理员查看所有用户列表
- [ ] 实现管理员手动升级用户订阅等级
- [ ] 实现管理员手动设置订阅到期时间
- [ ] 添加订阅操作日志记录
- [ ] 更新STRIPE_SETUP.md为支付说明文档

## 移除Stripe改用收款码支付 - 已完成
- [x] 移除Stripe SDK依赖
- [x] 移除Stripe相关后端代码(stripe.ts, webhooks/stripe.ts)
- [x] 从schema中移除stripeCustomerId字段
- [x] 重新设计订阅页面UI(显示收款码占位区)
- [x] 添加支付说明和联系方式
- [x] 实现管理员查看所有用户列表API
- [x] 实现管理员手动升级用户订阅API
- [x] 创建管理员用户管理页面
- [x] 在用户菜单添加管理员入口
- [x] 支持设置订阅到期时间
- [x] 升级订阅时自动发送通知

## 修改应用名称和添加收款码(第二十四批)
- [ ] 修改const.ts中的APP_TITLE为TeachPT
- [ ] 更新环境变量VITE_APP_TITLE
- [ ] 复制支付宝收款码到public目录
- [ ] 在订阅页面显示收款码
- [ ] 测试名称和收款码显示

## 修改应用名称和添加收款码 - 已完成
- [x] 复制支付宝收款码到public目录
- [x] 在订阅页面显示收款码(替换占位区域)
- [x] 应用名称已通过Management UI修改为TeachPT

## 更新联系方式和修复订阅问题(第二十五批)
- [ ] 生成TeachPT Logo
- [ ] 更新客服电话为8613138112934
- [ ] 更新客服邮箱为p.harrywu@gmail.com
- [ ] 修复管理员不应显示订阅限制
- [ ] 修复数据库日期格式错误(subscriptionEndDate)
- [ ] 管理员默认拥有所有权限

## 更新联系方式和修复订阅问题 - 已完成
- [x] 生成TeachPT Logo
- [x] 更新const.ts中的APP_LOGO
- [x] 更新客服电话为8613138112934
- [x] 更新客服邮箱为p.harrywu@gmail.com
- [x] 修复数据库日期格式错误(updateUserSubscription)
- [x] 管理员不受订阅限制(创建提示词和AI优化)
- [x] 管理员不显示订阅限制提示

## Favicon和订阅到期提醒(第二十六批)
- [ ] 复制Logo作为Favicon(用户在Management UI上传)
- [ ] 测试订阅流程完整性
- [ ] 实现订阅到期检查函数
- [ ] 实现定时任务发送到期提醒
- [ ] 测试到期提醒功能

## Favicon和订阅到期提醒 - 已完成
- [x] 复制Logo作为Favicon(已准备文件teachpt-favicon.png)
- [x] 实现订阅到期检查函数
- [x] 实现定时任务发送到期提醒(每天凌晨1点执行)
- [x] 实现过期订阅自动降级为免费版
- [x] 添加手动触发到期检查的API(管理员专用)

## 订阅续费和历史记录(第二十七批)
- [ ] 测试订阅流程完整性
- [ ] 在订阅页面添加续费功能
- [ ] 创建订阅历史记录数据库表
- [ ] 实现订阅历史记录API
- [ ] 创建订阅历史页面
- [ ] 在所有订阅操作时记录历史

## 订阅续费和历史记录 - 已完成
- [x] 创建订阅历史记录数据库表
- [x] 实现订阅历史记录API
- [x] 在升级订阅时自动记录历史
- [x] 创建订阅历史页面
- [x] 在订阅页面添加续费功能
- [x] 在订阅页面添加查看历史记录入口

## 管理员功能增强和优惠券系统(第二十八批)
- [x] 在管理员用户管理页面添加订阅历史查看功能
- [x] 创建优惠券数据库表
- [x] 实现优惠券管理API(创建、查询、验证)
- [x] 创建优惠券管理页面(管理员)
- [x] 在订阅页面集成优惠券使用功能
- [x] 实现订阅历史批量导出为Excel/CSV
- [x] 实现用户列表批量导出为Excel/CSV

## 批量导出功能已完成
- [x] 安装xlsx库
- [x] 创建导出工具函数(exportToExcel, exportToCSV)
- [x] 在订阅历史页面添加导出按钮
- [x] 在管理员用户管理页面添加导出按钮
- [x] 支持导出为Excel和CSV格式
